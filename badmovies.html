<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bad Movie Locator - Find the worst movies of all time!</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
 <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Roboto', sans-serif;
        }
        h1 {
        margin-top: 20px;
        margin-bottom: 40px;
        }
    
    .movie-card {
        margin-bottom: 30px;
    }

    .movie-rating {
        font-size: 1.5rem;
        font-weight: bold;
    }
   
    #movie-list {
    max-height: 800px;
    overflow-y: auto;
}

    .movie-title {
        font-size: 1.2rem;
        font-weight: bold;
    }

    .movie-description {
        font-size: 1rem;
        margin-top: 5px;
    }
    
    .movie-imdb-rating {
        font-size: 1rem;
        font-weight: bold;
        margin-top: 5px;
        color: #eb9e34;
    }

.input-field {
    margin-bottom: 20px;
}

</style>
</head>
<body>
    <div class="container">
        <h1 class="center-align">Bad Movies</h1>
        <div class="row">
            <div class="input-field col s12 m6">
                <input type="text" id="search" class="validate">
                <label for="search">Search</label>
            </div>
            <div class="input-field col s12 m6">
                <select id="genre-filter">
                    <option value="" disabled selected>Choose a genre</option>
                    <option value="28">Action</option>
                    <option value="35">Comedy</option>
                    <option value="18">Drama</option>
                    <option value="878">Sci-fi</option>
                    <option value="10749">Romance</option>
                    <option value="9648">Mystery</option>
                    <option value="27">Horror</option>
                </select>
                
                <label>Filter by Genre</label>
            </div>
        </div>
        <div id="movie-list" class="row">
            <!-- Movie cards show up here  -->
        </div>
        <div id="pagination">
            <ul class="pagination center-align">
              <li class="waves-effect" id="previous-page">
                <a href="#!"><i class="material-icons">chevron_left</i></a>
              </li>
              <li class="waves-effect" id="next-page">
                <a href="#!"><i class="material-icons">chevron_right</i></a>
              </li>
            </ul>
          </div>
          
    </div>
 <script>
       const apiKey = '39f23a391c6157c866eb13b5a33b4be5';
        document.getElementById('search').addEventListener('input', function() {
    searchMovies(this.value);
});



function displayMovies(movies) {
    const movieList = document.getElementById('movie-list');
    movieList.innerHTML = '';

    // Fetch IMDb ratings and store them in a new array
    const moviePromises = movies.map(async (movie) => {
        const tmdbMovieId = movie.id;

        const tmdbData = await fetch(`https://api.themoviedb.org/3/movie/${tmdbMovieId}?api_key=${apiKey}`).then(response => response.json());
        const imdbId = tmdbData.imdb_id;

        if (imdbId) {
            const omdbData = await fetch(`http://www.omdbapi.com/?i=${imdbId}&apikey=f4a92005`).then(response => response.json());
            return { ...movie, omdbData };
        } else {
            return null;
        }
    });

    // Wait for all IMDb ratings to be fetched
    Promise.all(moviePromises).then(moviesWithRatings => {
        // Filter out movies without IMDb ratings
        const filteredMovies = moviesWithRatings.filter(movie => movie !== null);

        // Sort movies based on IMDb rating
        filteredMovies.sort((a, b) => parseFloat(a.omdbData.imdbRating) - parseFloat(b.omdbData.imdbRating));

        // Set the threshold for the lowest-rated movies (e.g., top 5 lowest-rated)
        const lowestRatedMovies = filteredMovies.slice(0, 300);

        lowestRatedMovies.forEach(movie => {
            const movieCard = `
                <div class="col s12 m6 l4">
                    <div class="card">
                        <div class="card-image">
                            <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title} poster">
                        </div>
                        <div class="card-content">
                            <span class="movie-title">${movie.title}</span>
                            <p class="movie-imdb-rating">IMDb: ${movie.omdbData.imdbRating}</p>
                            <p class="movie-description">${movie.overview}</p>
                        </div>
                    </div>
                </div>
            `;
            movieList.innerHTML += movieCard;
        });
    }).catch(error => {
        console.error('Error fetching movie data:', error);
    });
}

function fetchMovies(url) {
  fetch(url)
    .then(response => response.json())
    .then(async data => {
      const moviePromises = data.results.map(async (movie) => {
        const tmdbMovieId = movie.id;

        const tmdbData = await fetch(`https://api.themoviedb.org/3/movie/${tmdbMovieId}?api_key=${apiKey}`).then(response => response.json());
        const imdbId = tmdbData.imdb_id;

        if (imdbId) {
          const omdbData = await fetch(`http://www.omdbapi.com/?i=${imdbId}&apikey=f4a92005`).then(response => response.json());
          return { ...movie, omdbData };
        } else {
          return null;
        }
      });

      Promise.all(moviePromises).then(moviesWithRatings => {
        const filteredMovies = moviesWithRatings.filter(movie => movie !== null && movie.omdbData && movie.omdbData.imdbRating);
        filteredMovies.sort((a, b) => parseFloat(a.omdbData.imdbRating) - parseFloat(b.omdbData.imdbRating));
        displayMovies(filteredMovies);
      });
    })
    .catch(error => {
      console.error('Error fetching data:', error);
    });
}


let currentPage = 1;
const moviesPerPage = 10;

function fetchBadMovies(page = 1) {
  const badMoviesUrl = `https://api.themoviedb.org/3/discover/movie?api_key=${apiKey}&sort_by=vote_average.asc&vote_count.gte=50&page=${page}`;
  fetchMovies(badMoviesUrl);
}

// Call fetchBadMovies function to display movies when the page loads
fetchBadMovies();


function searchMovies(query, page = 1) {
  if (query) {
    const searchUrl = `https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${encodeURIComponent(query)}&sort_by=vote_average.asc&page=${page}`;
    fetchMovies(searchUrl);
  } else {
    // If search is empty only bad movies are shown
    fetchBadMovies(page);
  }
}

function filterMoviesByGenre(genre, page = 1) {
  if (genre) {
    const genreUrl = `https://api.themoviedb.org/3/discover/movie?api_key=${apiKey}&with_genres=${genre}&sort_by=vote_average.asc&page=${page}`;
    fetchMovies(genreUrl);
  } else {
    // If no genre is selected, display the bad movies
    fetchBadMovies(page);
  }
}

function fetchPopularMovies() {
  for (let page = 1; page <= 50; page++) {
    const popularUrl = `https://api.themoviedb.org/3/movie/popular?api_key=${apiKey}&page=${page}`;
    fetchMovies(popularUrl);
  }
}


document.getElementById('search').addEventListener('input', function () {
  currentPage = 1;
  searchMovies(this.value, currentPage);
});

document.addEventListener('DOMContentLoaded', function () {
    const elems = document.querySelectorAll('select');
    const instances = M.FormSelect.init(elems);
});

document.getElementById('genre-filter').addEventListener('change', function () {
  currentPage = 1;
  filterMoviesByGenre(this.value, currentPage);
});

document.getElementById('previous-page').addEventListener('click', () => {
  if (currentPage > 1) {
    currentPage--;
    updatePage();
  }
});

document.getElementById('next-page').addEventListener('click', () => {
  currentPage++;
  updatePage();
});

function updatePage() {
  const searchInput = document.getElementById('search');
  const genreFilter = document.getElementById('genre-filter');
  if (searchInput.value) {
    searchMovies(searchInput.value, currentPage);
  } else if (genreFilter.value) {
    filterMoviesByGenre(genreFilter.value, currentPage);
  } else {
    fetchBadMovies(currentPage);
  }
}
    </script>
    </body>
    </html>